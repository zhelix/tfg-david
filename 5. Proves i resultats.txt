1. Montaje de la arquitectura de red entre los dispositivos y garantizar acceso a Internet para los equipos conectados en cada uno de los routers.

Las conexiones se realizarán siguiendo el esquema de la siguiente imagen, donde el MikroTik17 actuará como salida a la red de Internet mediante un bridge inalámbrico a otro dispositivo externo. Para garantizar un esquema de alta disponibilidad, se mantendrá que cada router disponga de conexión a dos routers alternos, para que en caso de que falle uno colindante, se pueda seguir manteniendo acceso a la raíz de la red para asi mantener la conexión.

//IBIZA REVISA AÇO// 	|
///IBIZA REVISA AÇO// 	|
//IBIZA REVISA AÇO//	V
En el resto de dispositivos, los puertos existente en cada uno de ellos se agruparan como un solo bridge, donde se aplicará la configuración del protocolo STP. Además, en el router principal, en este caso el MikroTik17, ejecutara un servidor DHCP para la configuración automática de direcciones IP y asi facilitar la identificación y el acceso a las diferentes máquinas conectadas.
//IBIZA REVISA AÇO// 	A
///IBIZA REVISA AÇO// 	|
//IBIZA REVISA AÇO//	|

Una vez realizada la conexión entre dispositivos de manera correcta, es posible observar un mal funcionamiento en nuestra arquitectura de red, ya que se pueden haber creado bucles que saturen la red. Cuando tengamos la conexión realizada deberíamos mediante la herramienta PING desde todos los equipos conectados a la red que se puede acceder a Internet obteniendo respuesta, desconectando algún equipo si se requiere. En nuestro caso, el PING se ha realizado sobre el servidor DNS de la compañía Google.

(Image del ping)

2. Configurar el STP.

El siguiente paso será la configuración propia del protocolo STP. En equipos MikroTik, RouterOS dispone de gran cantidad de herramientas avanzadas de configuración de redes, entre ellas, el protocolo de routing STP.

Accediendo al menú Bridges en RouterOS, podemos configurar en cada uno que haga uso del protocolo del caso práctico, el cual se deberá de configurar en todos los bridges de cada equipo, donde además, en el router que actuará como raíz (root bridge) en nuestro caso el MikroTik17, se deberá de modificar el valor de Priority a un valor más bajo para especificar que esta será la "salida" de nuestra red al exterior.

Cuando configuremos todos los bridges de los 4 dispositivos routers, deberíamos comprobar que después de un tiempo de convergencia la red funciona de forma estable y que todos los dispositivos pueden tener acceso a Internet, lo más práctico realizando de nuevo PING sobre cualquier direccion.

3. Desactivar el STP en modo Seguro.

Una vez tengamos configurada de forma correcta el protocolo en todos los dispositivos y todos tengan acceso a Internet, desactivaremos dentro del modo seguro de RouterOS el protocolo STP para ver cómo se altera el comportamiento normal de la red y se efectúa un bloqueo de los dispositivos al poco tiempo de su funcionamiento.

El modo seguro garantiza que si la configuración aplicada dentro de este modo cierra la sesión SAFE de forma inesperada, se cargará la ultima configuracion buena conocida, la anterior con STP, de esta forma, si algún dispositivo entra en saturación por caer dentro de la redundancia de la red, se rectifica a la configuración anterior que era plenamente funcional para poder volver a acceder a cada uno de los routers.

4. Quitar la conexión entre dos routers.

Para ver como se reestablece el cauce de datos por la red frente a la caída de un equipo o desconexión de un enlace de red, se realizará la siguiente prueba.
Con los dispositivos plenamente funcionales bajo el protocolo STP, se desconectara el cable que conecta el equipo Mikrotik1 con el Mikrotik16, donde esta conexión es la predeterminada o 'root port' para el dispositivo Mikrotik16, siendo el puerto principal para salida de este dispositivo.

Para comprobar cómo se mantiene la disponibilidad de la conexión a pesar de la desconexión o caída de un equipo colindante, se realizará un PING continuo desde el equipo conectado al MikroTik16, y acto seguido se desconectara el enlace entre los dos routers.

Si todo está correctamente configurado, una vez retiremos el cable, en el terminal donde se está realizando el PING podremos observar una perdida de paquetes o direccion inalcanzable por unos momentos, pero posteriormente, después de un tiempo de convergencia la conexión se debería de reanudar y continuar con el tráfico anterior de forma normal.

Imatge (ping  equip conectat al 16 troquelant.png)

5. Conectar cableado adicional entre dispositivos para observar el redireccionamiento de tráfico automatico.

5.5 Modificar el valor de PATH COST.

- Gestionar prioridades de STP.
	Vamos a realizar un cambio en el parámetro de 'Path cost' para modificar el camino que tomarán los datos.
	
	El 'Path cost' inicial de todos los interfaces es de 10 como podemos ver en la siguiente imagen.
	(foto -> winbox screens\pathcost winbox 1)
	
	Vemos como el 'ether1' está configurado como 'root port' i tiene un Root Path Cost de 10.
	
	Modificamos el valor del 'Path cost' del 'ether1' para cambiar el 'root port', y establecemos un 'Path cost' de 1000.
	(foto -> winbox screens\pathcost winbox 2 )
	
	Automáticamente se establece como 'root port' el interfaz 'ether4' que estaba antes como 'alternated port'.



6. Configurar para proteger la estructura cuando se añada un dispositivo en un extremo de la red configurado con STP. (CAMPO EDGE)


7. Configurar para proteger la estructura cuando un posible usuario cree un lazo cerrado entre dos puertos. (CAMPO HORIZON)
Podemos evitar bucles cuando se establezca una conexión mediante un enlace físico utilizando un cable de red y conectando los dos extremos del mismo a diferentes puertos de un mismo dispositivo Mikrotik.

\begin{figure}[h!]\centering
	\incluyeGrafico[width=0.45\textwidth]{horitzon}
	\caption{Configuración valor horitzon interfaz ether1}
	\label{horitzon}
	\bigskip
\end{figure}

Configuraremos todas las interfaces del mismo dispositivo Mikrotik que conecten directamente con los clientes con el mismo valor de Horitzon.

8. Configurar para evitar los dos problemas anteriores combinados. (EDGE/HORIZON)


9. Análisis de los problemas durante la realización de la práctica.

En ocasiones la conexion con el dispositivo Mikrotik no se ha podido realizar a causa de que los dipositivos se quedaban bloqueados por un exceso de tráfico teniendo que reiniciarlos.



