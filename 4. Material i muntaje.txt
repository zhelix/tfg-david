\section{Introducción}
Para la realización el montaje de la arquitectura e implementacion del protocolo Spaning-Tree-Protocol(STP) se ha utilizado el siguiente material:

-4 Dispositivos RouterBOARD RB9512N.
-Cableado ethernet CAT-5E.
-Equipos portátiles.
-Router RB2011UiAS-2HnD-IN.

\section{Montajes de la red}

En la siguiente figura \autoref{f1} vemos el dispositivo MikroTik en cuestión.


%FIGURA1

\subsection{Montaje básico}

Físicamente el montaje de equipos queda de la siguiente forma \autoref{f2}.

%FIGURA2


Podemos ver en la \autoref{f3} el esquema lógico de la conexión de los cuatro equipos MikroTik:

%FIGURA3

Los equipos portátiles personales se conectan al puerto ether5 de cada equipo, para poder entrar a configurar los mismos, como tenemos servidor DHCP no será necesario configurar ninguna IP.

\subsection{Montaje básico + diagonal}

Despues de unas primeras pruebas basicas, se añadiran dos conexiones adicionales al montaje básico, estableciendo nuevos caminos y mas redundancia a la configuración STP.

\section{Configuración}

\subsection{Config básica IP}

A continuacion se mostrara informacion relacionada con los equipos MikotTik utilizados, asi como nombre asignado, direccion IP y version de RouterOS
%TABLA
Dispositivo $n$ & Nombre & IP & Version RouterOS.

01 & MK01 - Bañuls & 192.168.1.1 & 6.28
15 & MK15 - Torres & 192.168.1.15 & 6.28
16 & MK16 - Rodriguez & 192.168.1.16 & 6.28
17 & MK17 - Ibiza & 192.168.1.17 & 6.32

Se ha utilizado el dispotivo MikroTik17 para interconectar mediante bridge a la red wireless del router RB2011UiAS-2HnD-IN para acceder a Internet.

\subsection{Config Wireless}

En el MikroTik17, se ha configurado el acceso a la red wireless, con las siguientes opciones:

Wlan1 con la IP 10.10.10.17 y default gateway al 10.10.10.100.

\subsection{Config bridge STP / RSTP}

Utilizando el software WinBox, en cada device se ha procedido a crear un bridge (opción BRIDGE), dejando el nombre por defecto de bridge1, seguidamente en ports se han añadido todas las interfaces del MikroTik como vemos en la siguiente \autoref{f4}.

%FIGURA4 - image del bridge i les boques

Una vez creado el bridge y insertadas las interfaces, se ha configurado la opción de STP en cada bridge marcando el radiobutton de "rstp", automáticamente el STP ya estará funcionando.

Cabe destacar, que para un funcionamiento adecuado de la red, debemos establecer una prioridad mas alta para un equipo en concreto, este equipo es el que se encarga de enrutar todo el tràfico hacia otra red, hacer NAT...Por lo que este dispositivo será en el que estableceremos una prioridad como vemos en la \autoref{f5}.

%FIGURA5 - Configuracio del RSTP i PRIORITAT

A partir de este punto, si conectamos todo de forma adecuada, la red debe funcionar correctamente via STP, en caso de fallar un enlace, automáticamente se resolveran los problemas de conectividad.

%%FIGURA6 -  


\subsubsection{Configuración para cliente (evitar otro dispositivo con STP)}

Para evitar que cualquier usuario conecte un switch con STP activado y una prioridad más alta que nuestro bridge, tenemos que configurar en el puerto de usuario un parámetro para definir que a esa interfaz se va a conectar un extremo, por lo que no será necesario trabajar con STP a partir de ese punto.

Se ha configurado el parámetro

%GASTAR MERDA.

Y ya evitamos que el dispositivo conectado a esa interfaz, trabaje por STP. Ya tendríamos el problema solucionado, pero si en dos puertos que tenemos Edge=YES creamos un bucle, bloquearemos el dispositivo.

En el punto siguiente, veremos como evitar bucles en la parte del cliente.

\subsubsection{Configuración para cliente (evitar bucles en el cliente)}

Si creamos un bucle en interfaces Edge=Yes, bloquearemos el dispositivo, ya que se va a generar un bucle infinito de tráfico. Podemos evitar esot de la siguiente forma.

Activaremos la opción de HORIZON, y estableceremos el mismo número. Evitaremos que se generen bucles, pero no vamos a poder tener comunicación entre estos dos dispositivos.
%GASTAR HORIZON

\subsubsection{Configuración de coste de path}

Una opción interesante en STP es poder establecer el coste de los caminos, con fin de optimizar la red y decidir por donde nos interesa mas llevar el tráfico.

Es posible que tengamos 2 caminos diferentes para llegar a un mismo destino, por lo que podemos configurar la interfaz y establecer un coste del camino (Path cost).

En el siguiente ejemplo, se ha configurado un path cost de 99999, por lo que primero se utilizaran caminos con un path cost <99999.


\subsubsection{Bucle para Backup Port}

Podemos crear bucles entre puertos configurados como STP, automáticamente el dispositivo asignara dicho puerto como Backup Port, en caso de fallar una conexión, seguirá funcionado como Backup Port.







